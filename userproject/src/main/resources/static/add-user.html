<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add New User</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="email"], input[type="password"] { width: 300px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        .error-message { color: red; font-size: 0.8em; margin-top: 2px; height: 1.2em; }
        #status-message { padding: 10px; margin-bottom: 20px; border-radius: 4px; font-weight: bold; display: none; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .failure { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        nav { margin-bottom: 20px; }
    </style>
</head>
<body>
    <nav>
        <a href="/add-user.html">Add User</a> | 
        <a href="/list-user.html">List Users</a>
    </nav>
    
    <h2>Add New User</h2>
    
    <div id="status-message"></div>
    
    <form id="addUserForm">
        
        <div class="form-group">
            <label for="firstName">First Name:</label>
            <input type="text" id="firstName" name="firstName" required>
            <div id="firstNameError" class="error-message"></div>
        </div>
        
        <div class="form-group">
            <label for="lastName">Last Name:</label>
            <input type="text" id="lastName" name="lastName" required>
            <div id="lastNameError" class="error-message"></div>
        </div>

        <div class="form-group">
            <label for="username">Username (Unique):</label>
            <input type="text" id="username" name="username" required>
            <div id="usernameError" class="error-message"></div>
        </div>

        <div class="form-group">
            <label for="email">Email (Unique):</label>
            <input type="email" id="email" name="email" required>
            <div id="emailError" class="error-message"></div>
        </div>

        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required>
            <div id="passwordError" class="error-message"></div>
        </div>
        
        <button type="submit">Add User</button>
    </form>
    
    <script>
        const API_URL = '/api/user/add';
        
        const AUTH_HEADER = 'Basic YWRtaW46c2VjdXJlcGFzc3dvcmQ='; 

        function validateForm() {
            let isValid = true;
            
            $('.error-message').text('');

            $('#addUserForm input[required]').each(function() {
                if ($(this).val().trim() === '') {
                    const fieldName = $(this).attr('name');
                    $('#' + fieldName + 'Error').text(fieldName.replace(/([A-Z])/g, ' $1').trim() + ' is required.');
                    isValid = false;
                }
            });

            const email = $('#email').val().trim();
            if (email !== '' && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                $('#emailError').text('Invalid email format.');
                isValid = false;
            }

            const password = $('#password').val();
            if (password.length > 0 && password.length < 6) {
                $('#passwordError').text('Password must be at least 6 characters.');
                isValid = false;
            }

            return isValid; 
        }

        $('#addUserForm').on('submit', function(e) {
            e.preventDefault();
            
            if (!validateForm()) {
                return;
            }

            const userData = {
                username: $('#username').val(),
                firstName: $('#firstName').val(),
                lastName: $('#lastName').val(),
                email: $('#email').val(),
                password: $('#password').val()
            };
            
            $('#status-message').hide().removeClass('success failure').text('');

            $.ajax({
                url: API_URL,
                type: 'POST',
                contentType: 'application/json',
                headers: { 'Authorization': AUTH_HEADER },
                data: JSON.stringify(userData),
                
                headers: { 
                    'Authorization': AUTH_HEADER,
                    'Content-Type': 'application/json' // ENSURE THIS IS PRESENT
                },
                data: JSON.stringify(userData),
                
            
                success: function(response) {
                    $('#status-message')
                        .addClass('success')
                        .text(`SUCCESS: ${response.status} (User ID: ${response.userId})`)
                        .show();
                    $('#addUserForm')[0].reset(); 
                },
                
           
                error: function(xhr) {
                    let errorMsg = 'An unexpected error occurred.';
                    
                    if (xhr.status === 401) {
                         errorMsg = 'Authentication Failed: Invalid admin credentials.';
                    } else if (xhr.responseJSON && xhr.responseJSON.message) {
                       
                         errorMsg = xhr.responseJSON.message;
                    } else if (xhr.statusText) {
                         errorMsg = xhr.statusText;
                    }

                    $('#status-message')
                        .addClass('failure')
                        .text(`FAILURE: ${errorMsg}`)
                        .show();
                }
            });
        });
    </script>
</body>
</html>